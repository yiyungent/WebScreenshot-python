name: Run App

on:
  push:
  schedule:
    # å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯å¤©çš„5ç‚¹æ‰§è¡Œ
    - cron: '0 21 * * *'

jobs:
  run-app:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python 3.8
      uses: actions/setup-python@v2
      with:
        python-version: 3.8
        
    - name: Add conda to system path
      run: |
        # $CONDA is an environment variable pointing to the root of the miniconda directory
        echo $CONDA/bin >> $GITHUB_PATH
    
    - name: Install dependencies
      run: |
        sudo apt-get install unzip
        sudo pip install selenium
        # å®‰è£… Chrome
        # TODO: å›ºå®š Chrome ç‰ˆæœ¬
        # æ³¨æ„: Chrome ç‰ˆæœ¬å¿…é¡»ä¸ chromedriver ç‰ˆæœ¬å¯¹åº”
        sudo wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome*.deb
        sudo apt-get install -f
        # TODO: è¾“å‡ºChromeç‰ˆæœ¬, å¤±è´¥
        echo /usr/bin/google-chrome --version
        # å®‰è£… chromedriver
        sudo wget http://chromedriver.storage.googleapis.com/88.0.4324.96/chromedriver_linux64.zip
        sudo unzip chromedriver_linux64.zip
        # ä¸ºæ‰€æœ‰ç”¨æˆ·æ·»åŠ å¯æ‰§è¡Œæƒé™ (å¯¹chromedriveræ–‡ä»¶)
        sudo chmod a+x chromedriver
        # ä¸‹é¢ä¸¤è¡Œå®‰è£…ä¸­æ–‡å­—ä½“
        sudo apt install -y --force-yes --no-install-recommends fonts-wqy-microhei
        sudo apt install -y --force-yes --no-install-recommends ttf-wqy-zenhei
        
    - name: Run App
      run: |
        sudo python main.py
      env:
        URLS: ${{ secrets.URLS }}
        TZ: Asia/Shanghai
    
    - name: Deploy ğŸš€
      uses: JamesIves/github-pages-deploy-action@3.7.1
      with:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        BRANCH: gh-pages
        FOLDER: screenshots
        clean: false
